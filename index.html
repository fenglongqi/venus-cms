<!DOCTYPE html>
<html lang="zxx">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Taole Auto Build System</title>

    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/vendor-styles.css" rel="stylesheet">
      <link rel="stylesheet" href="css/styles.css">
      <link rel="stylesheet" href="css/index.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="main-wrapper">
      <div class="an-loader-container">
        <img src="img/loader.png" alt="">
      </div>


      <header id="header" class="an-header wow fadeInDown"></header>

      <div class="an-notification-content top-full-width">
        <div class="alert alert-danger  js-nofitication-body" role="alert">
          <button type="button" class="close"><span aria-hidden="true">&times;</span></button>
          <strong>警告!</strong> 当前未发现可用的客户端，请先安装并运行客户端.
        </div>
      </div>

      <div  class="an-page-content">
        <div id="sidebar" class="an-sidebar-nav js-sidebar-toggle-with-click">
          
        </div> <!-- end .AN-SIDEBAR-NAV -->

        <div class="an-content-body">

          <div class="an-body-topbar wow fadeIn">
            <div class="an-page-title">
              <h2>控制面板</h2>
              <p>Welcome to use this system
                <a href="#"><i class="icon-marker"></i>杭州</a>
              </p>
            </div>

            <div class="an-daterange-picker">
              <div id="reportrange" class="pull-right">
                <i class="icon-calendar"></i>&nbsp;
                <span></span>
              </div>
            </div> <!-- end AN-DATERANGE-PICKER -->
          </div> <!-- end AN-BODY-TOPBAR -->

          <div class="an-panel-main-info">
            <div class="row an-agent-info-item">
            </div> <!-- end .ROW -->
          </div> <!-- end .AN-PANEL-MAIN-INFO -->

          <div class="row">
            <div class="col-md-6">
              <div class="an-single-component with-shadow wow fadeIn">
                <div class="an-component-header">
                  <h6>CPU运行监听</h6>
                </div>
                <div class="an-component-body">
                  <div class="an-chart-content">
                    <canvas class="lineChart"></canvas>
                    <div class="chart-legend js-legend"></div>
                  </div> <!-- end .AN-CHART-CONTENT -->
                </div> <!-- end .AN-COMPONENT-BODY -->
              </div> <!-- end .AN-SINGLE-COMPONENT -->
            </div>

            <div class="col-md-6">
              <div class="an-single-component with-shadow wow fadeIn">
                <div class="an-component-header">
                  <h6 class="agent-disk-info-header">磁盘监控</h6>
                  <div class="component-header-right">
                    <div class="an-settings-button">
                      <a class="reload" href="#"><i class="icon-loading"></i></a>
                      <a class="remove" href="#"><i class="icon-close"></i></a>
                    </div>
                  </div>
                </div>
                <div class="an-component-body">
                  <div class="an-chart-content doughnut">
                    <canvas class="doughNut-chart"></canvas>

                    <div class="chart-legend js-legendDoughnut doughnut"></div>
                  </div> <!-- end .AN-CHART-CONTENT -->
                </div> <!-- end .AN-COMPONENT-BODY -->
              </div> <!-- end .AN-SINGLE-COMPONENT -->
            </div>
          </div> <!-- end first row -->

          <div class="row">
            <div class="col-md-3">
              <div class="row">
                <div class="col-md-12">
                  <div class="an-single-component with-shadow">
                    <div class="an-component-header">
                      <h6>内存监控</h6>
                      <div class="component-header-right">
                        <div class="an-settings-button">
                          <a class="only-hover-remove" href="#"><i class="icon-close"></i></a>
                        </div>
                      </div>
                    </div>

                    <div class="an-component-body">
                      <div class="an-progressbar-content">
                        <div class="ancircleprogressbar js-circle">
                          <div class="value">
                            <div class="value-holder"></div>
                            <span>内存占用</span>
                          </div>
                        </div>
                      </div> <!-- end .AN-PROGRESSBAR-CONTENT -->
                    </div> <!-- end .AN-COMPONENT-BODY -->
                  </div> <!-- end .AN-SINGLE-COMPONENT -->
                </div>
              </div> <!-- end NASTED ROW -->
            </div>
          </div>


          <div class="an-single-component with-shadow" id="script-content">
            <div class="an-component-header">
              <h6>脚本信息</h6>
              
              <div class="component-header-right">
                <div>
                    <span class="script-reload"><i class="icon-loading"></i></span>
                </div>
                <form class="an-form" action="#">
                  <div class="an-search-field">
                    <input class="an-form-control" type="text" placeholder="Search...">
                    <button class="an-btn an-btn-icon" type="submit"><i class="icon-search"></i></button>
                  </div>
                </form>
                <div class="an-default-select-wrapper">
                  <select name="sort">
                    <option value="0">Show All</option>
                    <option value="1">Unread</option>
                    <option value="2">Read</option>
                  </select>
                </div>
                <div class="an-default-header-right">
                    <button class="an-btn an-btn-icon an-btn-primt add-script" type="button">新建</button>
                </div>
              </div>
            </div>
            <div class="an-component-body">
              <div class="an-user-lists messages">
                <div class="list-title">
                  <h6 class="basis-30">脚本名称</h6>
                  <h6 class="basis-30">修改日期</h6>
                  <h6 class="basis-10">类型</h6>
                  <h6 class="basis-10">状态</h6>
                  <h6 class="basis-20">操作</h6>
                </div>

                <div class="task-list an-lists-body an-customScrollbar">



                </div> <!-- end .AN-LISTS-BODY -->
              </div>
            </div> <!-- end .AN-COMPONENT-BODY -->
          </div> <!-- end .AN-SINGLE-COMPONENT messages -->



        </div> <!-- end .AN-PAGE-CONTENT-BODY -->
      </div> <!-- end .AN-PAGE-CONTENT -->



      <footer id="footer" class="an-footer">
        
      </footer> <!-- end an-footer -->

      <div id="add-script-alert" class="an-single-component">
        <div class="an-component-header">
            <h4>添加新的脚本</h4>
            <div><a class="only-hover-remove add-script-close"  href="#"><i class="icon-close"></i></a></div>
        </div>
        <div class="an-component-body">
            <ul>
              <li>
                <span class="li-title">脚本类型：</span>
                <select id="script-type" name="sort">
                  <option value="1">直接打包</option>
                  <option value="4">git打包</option>
                  <option value="2">下载</option>
                  <option value="3">执行cmd</option>
                </select>
              </li>
              <li class="type1">
                <span class="li-title">工程所在路径</span>
                <input type="text" id="script-path">
              </li>
              <li class="type4">
                <span class="li-title">工程git远程地址</span>
                <input type="text" id="script-remote_url">
              </li>
              <li class="type4">
                <span class="li-title">工程的branch分支名称</span>
                <input type="text" id="script-branch">
              </li>
              <li class="type1 type4">
                <span class="li-title">工程的workspace名称</span>
                <input type="text" id="script-workspace">
              </li>
              <li class="type1 type4">
                <span class="li-title">工程scheme</span>
                <input type="text" id="script-scheme">
              </li>
              <li class="type1 type4">
                <span class="li-title">证书</span>
                <select name="" id="script-cer-id">

                </select>
                <button id="add-cer" type="button">添加证书</button>
              </li>
              <li class="type1 type4">
                <span class="li-title">证书密码</span>
                <input type="password" id="script-cer-pass">
              </li>
              <li class="type1 type4">
                <span class="li-title">客户端密码</span>
                <input type="text" id="script-agent-pass">
              </li>
              <li class="type3">
                <span class="li-title">cmd：</span><input type="text"  id="script-cmd">
              </li>
              <li class="type3">
                <span class="li-title">cwd：</span>
                <input type="text"  id="script-cwd">
              </li>
              <li class="type3" >
                <span class="li-title">async：</span> 
                <select name=""  id="script-async">
                  <option value="1">同步</option>
                  <option value="2">异步</option>
                </select>
              </li>
              <li class="tc">
                <button id="script-submit">确认</button>
              </li>
            </ul>
        </div>
          
      </div>

      <div class="task-result-alert">
        <h5>脚本执行结果<i class="result-alert-close-btn result-alert-close icon-close"></i></h5>
        <p class="task-result-message"></p>
        <div class="tc">
            <button class="result-alert-close-btn result-close-btn">关闭</button>
        </div>
        
      </div>

      <div class="add-cer">
          <h5>添加新证书</h5>
          <div><input id="cer-file" name="p12" type="file"></div>
          <div><button class="submit-cer">上传证书</button></div>
      </div>
    </div> <!-- end .MAIN-WRAPPER -->
    <script src="plugins/jquery-3.1.1.min.js" type="text/javascript"></script>
    <script src="plugins/bootstrap.min.js" type="text/javascript"></script>

    <!-- 渲染组件 -->
    <script src="components/head.js"></script>
    <script src="components/sidebar.js"></script>
    <script src="components/footer.js"></script>
    <script src="js/render.js"></script>

    <script src="plugins/moment.min.js" type="text/javascript"></script>
    <script src="plugins/daterangepicker.js" type="text/javascript"></script>
    <script src="plugins/wow.min.js" type="text/javascript"></script>
    <script src="plugins/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
    <script src="plugins/selectize.min.js" type="text/javascript"></script>
    <script src="plugins/owl.carousel.min.js" type="text/javascript"></script>
    <script src="plugins/Chart.min.js" type="text/javascript"></script>
    <script src="plugins/circle-progress.min.js" type="text/javascript"></script>
    <!-- <script src="/plugins/mustache.min.js"></script> -->

    <!--  MAIN SCRIPTS START FROM HERE  above scripts from plugin   -->
    <script src="js/customize-chart.js" type="text/javascript"></script>
    <script src="js/scripts.js" type="text/javascript"></script>
    <script src="js/cms-api.js" type="text/javascript"></script>
    <script src="js/cms-ui.js" type="text/javascript"></script>





    <script>
      

        var agent_list = []
          if ($('.js-nofitication-body').length > 0) {
            $('.js-nofitication-body').hide();
          }




          function handler_agent_status(success, message, data) {
              if (!success) {
                  return
              }

              var cpu_status = [];

              for (agent_status in data) {

                  var item = {
                      "per": data[agent_status].cpu.per,
                      "time": data[agent_status].update_time,
                  };
                  cpu_status.push(item);
              }
              refresh_cpu_status(cpu_status);
          }

          function show_agent_info(agent) {
              request_agent_cpu(agent.token, handler_agent_status);
              request_get_task_publish(agent.token, reder_task)
              $('#add-script-alert').data('token',agent.token)


              refresh_disk_status(agent.agent.disk);
              refresh_memory_status(agent.agent.mem);
          }

          function response(success, message, data) {
              if (!success) {
                  return
              }

              $(".agent-total").html(data.count_result.total_agent);
              $(".agent-free").html(data.count_result.alive_agent);
              $(".agent_working").html(data.count_result.working_agent);
              

              if(data.agent_list.length == 0) {
                  $(".js-nofitication-body").toggle();
                  $('.js-nofitication-body .close').on('click', function () {
                      $(this).parent().hide();
                  });
                  return
              }

              agent_list = data.agent_list;

              // 在UI上显示客户端基本信息
              show_current_agents(data.agent_list);

              current_agent = data.agent_list[0];
              show_agent_info(current_agent)
              $('.an-panel-main-info-single').eq(0).css('background','rgb(196, 204, 86)')
          }

          request_alive_agent(response);
          
          
          request_cer_list(function(success, msg, data){
            if(!success) {
              alert(msg)
              return
            }
  
            for(var i = 0, len = data.length;i<len; i++) {
              if(data[i].status == 1) {
                $('#script-cer-id').append('<option value='+data[i]._id+'>'+data[i].file_name+'</option>')
              }
            }
          })
           
      

        
                
    </script>
  </body>
</html>
